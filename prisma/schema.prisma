generator client {
  provider   = "prisma-client-js"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Competition {
  id           String         @id @default(uuid())
  title        String
  description  String
  poster       String?
  level        String
  category     String
  deadline     DateTime
  price        Int
  createdAt    DateTime       @default(now())

  requirements  CompetitionRequirement[]
  timelines     CompetitionTimeline[]
  registrations Registration[]
}

model PaymentProof {
  id             String        @id @default(uuid())
  registrationId String        @unique
  fileUrl        String
  status         PaymentStatus @default(PENDING)
  uploadedAt     DateTime      @default(now())
  registrations   Registration  @relation(fields: [registrationId], references: [id])
}

model Registration {
  id            String             @id @default(uuid())
  userId        String
  competitionId String
  phone         String
  school        String
  nisn          String
  address       String
  status        RegistrationStatus @default(PENDING)
  createdAt     DateTime           @default(now())
  paymentProof  PaymentProof?
  competition   Competition        @relation(fields: [competitionId], references: [id])
  user          User               @relation(fields: [userId], references: [id])
}

model User {
  id           String         @id @default(uuid())
  name         String
  email        String         @unique
  password     String
  role         Role           @default(PESERTA)
  birthDate    DateTime?
  school       String?
  createdAt    DateTime       @default(now())
  registrations Registration[]
}

model CompetitionRequirement {
  id            String @id @default(uuid())
  competitionId String
  text          String

  competition   Competition @relation(fields: [competitionId], references: [id], onDelete: Cascade)
}

model CompetitionTimeline {
  id            String @id @default(uuid())
  competitionId String
  title         String
  startDate     DateTime
  endDate       DateTime

  competition   Competition @relation(fields: [competitionId], references: [id], onDelete: Cascade)
}

enum PaymentStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum RegistrationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum Role {
  ADMIN
  PESERTA
}
